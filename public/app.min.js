"use strict";function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var Bookmark=function(){function o(t,e){_classCallCheck(this,o),this.elementId=t;this.options=_extends({},{},e);var n=document.getElementById(this.elementId);if(n){n.addEventListener("click",this.handleClick.bind(this)),n.addEventListener("keyup",this.handleKeyUp.bind(this)),n.addEventListener("change",this.handleChange.bind(this));n.innerHTML="<div>\n      <svg xmlns='http://www.w3.org/2000/svg' class='bookmarkBtn' viewBox='0 0 512 512'>\n        <title>Bookmark</title>\n        <path d='M352 48H160a48 48 0 00-48 48v368l144-128 144 128V96a48 48 0 00-48-48z' fill='none' stroke='currentColor'\n          stroke-linecap='round' stroke-linejoin='round' stroke-width='32' />\n        </svg>\n\n        <div class='bookmarkPopup' id='bookmarkPopup'></div>\n        <div class='bookmarkContainer' id='bookmarkContainer'>\n          <div class='bookmark-topline'>\n            <span class=\"heading\">Bookmarks</span><button class='createNew'>Create new bookmark</button>\n          </div>\n          <div class='btn'>\n          </div>\n          <div>\n            <input class='search' type='text' id=\"myInput\" placeholder=\"Search\">\n          </div>\n          <hr>\n          <div class='public'>\n          <div class=\"public-heading-caret\">\n              <svg class='public-caret caret' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 512 512'>\n                <title>Caret Down</title>\n                <path d='M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z' />\n              </svg>\n\n              <span class=\"heading\">Public bookmarks <span id=\"publicCount\">(0)</span></span>\n              </div>\n              <div id=\"public-placeholder\" class=\"active\"><p class='public-text'>You have no public bookmarks</p>\n              <p class='public-text'>Right-click on a bookmark and select 'Make public'.</p>\n            \n          </div>\n        </div>\n          <div class='my-bookmarks'>\n\n          <div class=\"heading-caret\">\n            <svg class='myBookmarks-caret caret' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 512 512'>\n              <title>Caret Down</title>\n              <path\n                d='M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z' />\n            </svg>\n            <span class=\"heading\">My bookmarks <span id=\"myBookmarksCount\">(0)</span></span>\n            </div>\n\n            <div id=\"myBookmarks-placeholder\" class=\"active\">\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class='createNewPopup' id='createForm'>\n    <div class='createTopline'>\n    <span class=\"heading\">Create bookmark</span>\n    <span class='closeCreate'><svg xmlns='http://www.w3.org/2000/svg' viewbox='0 0 512 512'>\n    <title>Close</title>\n    <path fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='32'\n      d='M368 368L144 144M368 144L144 368' />\n  </svg></span>\n\n    </div>\n    <hr>\n    <div class=\"create-input\">\n    <label for='bookmarkName' class=\"title\">Title</label>\n      <input type='text' class=\"bookmark-name\" id='bookmarkName' name='bookmarkName'>\n      <label for='bookmarkDescription' class=\"description\">Description <span class='optional'>(optional)</span></label><br>\n      <input type='text' id='bookmarkDescription' name='bookmarkDescription'>\n      <div class=\"create-flex\"><button type=\"button\" disabled class='createSubmit' id='createSubmit'>Create</button>\n      </div>\n    </div>\n  </div>\n    ",this.render()}}return _createClass(o,[{key:"render",value:function(o){var a=document.getElementById("publicCount"),i=[],s=document.getElementById("myBookmarksCount"),c=[];this.options.app.createSessionObject({qInfo:{qId:"BookmarkList",qType:"BookmarkList"},qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}).then(function(t){t.getLayout().then(function(t){t.qBookmarkList.qItems.forEach(function(t){!0===t.qMeta.published?o?-1!==t.qMeta.title.toLowerCase().indexOf(o.toLowerCase())&&i.push(t):i.push(t):o?-1!==t.qMeta.title.toLowerCase().indexOf(o.toLowerCase())&&c.push(t):c.push(t)});var e='<div id="info-popup-mask" class="info-popup-mask"></div>';i.forEach(function(t){console.log("public",t),e+='\n              <div class="public-li" id="public-li" data-bookmark="'.concat(t.qInfo.qId,'">\n              <span class="bookmark-text" data-bookmark="').concat(t.qInfo.qId,'">').concat(t.qMeta.title,'</span>\n              <div class="date-and-i">\n              <span class="bookmark-text">').concat(new Date(t.qMeta.createdDate).toLocaleString().slice(0,10),'</span>\n              <span class="infoBtn">\n               <svg data-bookmark="').concat(t.qInfo.qId,'" class="i-icon-public" id="i-icon-public" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n               <title>Information Circle</title><path d="M256 56C145.72 56 56 145.72 56 256s89.72 200 200 200 200-89.72 200-200S366.28 \n               56 256 56zm0 82a26 26 0 11-26 26 26 26 0 0126-26zm48 226h-88a16 16 0 010-32h28v-88h-16a16 16 0 010-32h32a16 16 0 0116 \n               16v104h28a16 16 0 010 32z"/>\n               </svg>\n               </span>\n               </div>\n              </div>\n             \n              <div class="info-popup" id="info-popup-').concat(t.qInfo.qId,'">\n              <div class="info-topline" id="info-topline-').concat(t.qInfo.qId,'">\n              <span class="description-heading" id="description-heading">').concat(t.qMeta.description,"</span>\n              </div>"),-1!==t.qMeta.privileges.indexOf("update")&&(e+='\n              <svg xmlns="http://www.w3.org/2000/svg" data-bookmark="'.concat(t.qInfo.qId,'" class="edit-info" viewBox="0 0 512 512">\n              <title>Create</title><path d="M384 224v184a40 40 0 01-40 40H104a40 40 0 01-40-40V168a40 40 0 0140-40h167.48"\n               fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/>\n               <path d="M459.94 53.25a16.06 16.06 0 00-23.22-.56L424.35 65a8 8 0 000 11.31l11.34 11.32a8 8 0 0011.34\n                0l12.06-12c6.1-6.09 6.67-16.01.85-22.38zM399.34 90L218.82 270.2a9 9 0 00-2.31 3.93L208.16 299a3.91 3.91\n                 0 004.86 4.86l24.85-8.35a9 9 0 003.93-2.31L422 112.66a9 9 0 000-12.66l-9.95-10a9 9 0 00-12.71 0z"/>\n                 </svg>\n                 </div>\n                 <div class="edit-topline">\n                 <svg xmlns="http://www.w3.org/2000/svg" class="tick-icon" id="tick-icon" viewBox="0 0 512 512">\n                 <title>Checkmark Circle</title><path d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none"\n                  stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" \n                  stroke-width="32" d="M352 176L217.6 336 160 272"/>\n                  </svg>\n                  <svg xmlns="http://www.w3.org/2000/svg" class="trash-icon" id="trashIcon" viewBox="0 0 512 512"><title>Trash</title>\n                  <path d="M296 64h-80a7.91 7.91 0 00-8 8v24h96V72a7.91 7.91 0 00-8-8z" fill="none"/>\n                  <path d="M432 96h-96V72a40 40 0 00-40-40h-80a40 40 0 00-40 40v24H80a16 16 0 000 32h17l19 304.92c1.42\n                   26.85 22 47.08 48 47.08h184c26.13 0 46.3-19.78 48-47l19-305h17a16 16 0 000-32zM192.57 416H192a16 16 0 \n                   01-16-15.43l-8-224a16 16 0 1132-1.14l8 224A16 16 0 01192.57 416zM272 400a16 16 0 01-32 0V176a16 16 0 0132\n                    0zm32-304h-96V72a7.91 7.91 0 018-8h80a7.91 7.91 0 018 8zm32 304.57A16 16 0 01320 416h-.58A16 16 0 01304 \n                    399.43l8-224a16 16 0 1132 1.14z"/>\n                    </svg>\n                  </div>\n                 <div id="edit-inputs" class="edit-inputs">\n                 <input type="text" id="edit-title" placeholder="Bookmark title"  value="').concat(t.qMeta.title,'"/>\n                 <input type="text" id="edit-description" placeholder="Bookmark description" value="').concat(t.qMeta.description,'"  />\n                 </div>')),e+='\n              <span class="selections"><b>Selections:</b> '.concat(t.qData.selectionFields,' </span>\n              <div class="info-copy">\n              <span class="set-expression">Set expression</span>\n              <input type="text" READONLY class="info-input" id="infoInput" value="').concat(t.qData.selectionFields,'" />\n            \n              <div class="flex">\n              <div class="copied" id="copied"><h5>copied to clipboard</h5></div>\n              <button class="copy">Copy</button>\n              </div>\n              \n              </div>\n              </div>\n             \n              '),-1!==t.qMeta.privileges.indexOf("delete")&&(e+=" <svg id=".concat(t.qInfo.qId," xmlns='http://www.w3.org/2000/svg' class='delete-icon'\n                viewBox='0 0 512 512'><title>Close</title><path fill='none'\n                stroke='currentColor' stroke-linecap='round' stroke-linejoin='round'\n                  stroke-width='32' d='M368 368L144 144M368 144L144 368'/>\n                  </svg>\n                  "))});var n="";c.forEach(function(t){console.log("my bookmark",t);new Date;t.qMeta.createdDate&&new Date(t.qMeta.createdDate),n+='\n              <div class="myBookmarks-li" id="myBookmarks-li>\n                <span class="bookmark-text data-bookmark="'.concat(t.qInfo.qId,'">').concat(t.qMeta.title,'</span>\n                <div class="date-and-i">\n                <span class="bookmark-text">').concat(new Date(t.qMeta.createdDate).toLocaleString().slice(0,10),'</span>\n                <span class="infoBtn">\n                <svg data-bookmark="').concat(t.qInfo.qId,'" class="i-icon-my" id="i-icon-my" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n                <title>Information Circle</title><path d="M256 56C145.72 56 56 145.72 56 256s89.72 200 200 200 200-89.72 200-200S366.28 \n                56 256 56zm0 82a26 26 0 11-26 26 26 26 0 0126-26zm48 226h-88a16 16 0 010-32h28v-88h-16a16 16 0 010-32h32a16 16 0 0116 \n                16v104h28a16 16 0 010 32z"/>\n                </svg>\n                </span>\n                </div>\n                </div>\n              \n                <div class="info-popup" id="info-popup-').concat(t.qInfo.qId,'">\n                <div class="info-topline" id="info-topline-').concat(t.qInfo.qId,'" data-bookmark="').concat(t.qInfo.qId,'">\n                <span class="description-heading" id="description-heading">').concat(t.qMeta.description,"</span>"),-1!==t.qMeta.privileges.indexOf("update")&&(n+='\n                <svg xmlns="http://www.w3.org/2000/svg" data-bookmark="'.concat(t.qInfo.qId,'" class="edit-info" id="edit-info-').concat(t.qInfo.qId,'" viewBox="0 0 512 512">\n                <title>Create</title><path d="M384 224v184a40 40 0 01-40 40H104a40 40 0 01-40-40V168a40 40 0 0140-40h167.48"\n                 fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/>\n                 <path d="M459.94 53.25a16.06 16.06 0 00-23.22-.56L424.35 65a8 8 0 000 11.31l11.34 11.32a8 8 0 0011.34\n                  0l12.06-12c6.1-6.09 6.67-16.01.85-22.38zM399.34 90L218.82 270.2a9 9 0 00-2.31 3.93L208.16 299a3.91 3.91\n                   0 004.86 4.86l24.85-8.35a9 9 0 003.93-2.31L422 112.66a9 9 0 000-12.66l-9.95-10a9 9 0 00-12.71 0z"/>\n                   </svg>\n                   </div>\n                   <div class="edit-topline">\n                   <svg xmlns="http://www.w3.org/2000/svg" data-bookmark="').concat(t.qInfo.qId,'" class="tick-icon" id="tick-icon-').concat(t.qInfo.qId,'" viewBox="0 0 512 512">\n                   <title>Checkmark Circle</title><path d="M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none"\n                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" \n                    stroke-width="32" d="M352 176L217.6 336 160 272"/>\n                    </svg>'),-1!==t.qMeta.privileges.indexOf("delete")&&(n+='\n                    <svg xmlns="http://www.w3.org/2000/svg" class="trash-icon" data-bookmark="'.concat(t.qInfo.qId,'" id="trashIcon-').concat(t.qInfo.qId,'" viewBox="0 0 512 512"><title>Trash</title>\n                    <path d="M296 64h-80a7.91 7.91 0 00-8 8v24h96V72a7.91 7.91 0 00-8-8z" fill="none"/>\n                    <path d="M432 96h-96V72a40 40 0 00-40-40h-80a40 40 0 00-40 40v24H80a16 16 0 000 32h17l19 304.92c1.42\n                     26.85 22 47.08 48 47.08h184c26.13 0 46.3-19.78 48-47l19-305h17a16 16 0 000-32zM192.57 416H192a16 16 0 \n                     01-16-15.43l-8-224a16 16 0 1132-1.14l8 224A16 16 0 01192.57 416zM272 400a16 16 0 01-32 0V176a16 16 0 0132\n                      0zm32-304h-96V72a7.91 7.91 0 018-8h80a7.91 7.91 0 018 8zm32 304.57A16 16 0 01320 416h-.58A16 16 0 01304 \n                      399.43l8-224a16 16 0 1132 1.14z"/>\n                      </svg>\n                    </div>\n                    ')),n+='\n                   <div id="edit-inputs-'.concat(t.qInfo.qId,'" data-bookmark="').concat(t.qInfo.qId,'" class="edit-inputs">\n                   <input type="text" id="edit-title-').concat(t.qInfo.qId,'" placeholder="Bookmark title" value="').concat(t.qMeta.title,'"/>\n                   <input type="text" id="edit-description-').concat(t.qInfo.qId,'" placeholder="Bookmark description" value="').concat(t.qMeta.description,'"  />\n                   </div>')),n+='\n              <span class="selections"><b>Selections:</b> '.concat(t.qData.selectionFields,' </span>\n              <div class="info-copy">\n              <span class="set-expression">Set expression</span>\n              <input type="text" READONLY class="info-input" value="').concat(t.qData.selectionFields,'" />\n              <div class="flex">\n              <div class="copied" id="copied"><h5>copied to clipboard</h5></div>\n              <button class="copy">Copy</button>\n              </div>\n              </div>\n              </div>\n              ')}),document.getElementById("public-placeholder").innerHTML=e,document.getElementById("myBookmarks-placeholder").innerHTML=n,a.textContent="("+i.length+")",s.textContent="("+c.length+")"})})}},{key:"handleKeyUp",value:function(t){var e=document.getElementById("bookmarkName").value;t.target.classList.contains("search")&&this.searchFunction(),t.target.classList.contains("bookmark-name")&&(0===e.length?this.disableCreate():this.enableCreate())}},{key:"handleClick",value:function(t){var n=this,e=document.getElementById("bookmarkName"),o=document.getElementById("bookmarkDescription");(t.target.classList.contains("bookmarkBtn")&&this.openForm(),t.target.classList.contains("bookmarkPopup"))&&(this.closeForm(),this.closeBookmark(),Array.from(document.getElementsByClassName("info-popup")).forEach(function(t){t.classList.remove("active")}),document.getElementById("info-popup-mask").classList.remove("active"));(t.target.classList.contains("createNew")&&this.createNewBookmark(),t.target.classList.contains("closeCreate"))&&(document.getElementById("bookmarkPopup").style.backgroundColor="transparent",this.closeBookmark());(t.target.classList.contains("public-heading-caret")&&this.closePublicUL(),t.target.classList.contains("heading-caret")&&this.closeMyBookmarksUL(),t.target.classList.contains("createSubmit"))&&(document.getElementById("bookmarkPopup").style.backgroundColor="transparent",this.options.app.createBookmark({qInfo:{qType:"bookmark"},qMetaDef:{title:"".concat(e.value),description:"".concat(o.value)}}).then(function(){document.getElementById("bookmarkName").value="",n.render()}),this.closeBookmark());(t.target.classList.contains("trash-icon")&&this.options.app.destroyBookmark(t.target.id).then(function(){n.render()}),t.target.classList.contains("i-icon-public")&&this.toggleInfo(t),t.target.classList.contains("i-icon-my")&&this.toggleInfo(t),t.target.classList.contains("info-popup-mask"))&&(Array.from(document.getElementsByClassName("info-popup")).forEach(function(t){t.classList.remove("active")}),document.getElementById("info-popup-mask").classList.remove("active"));if(t.target.classList.contains("edit-info")&&(this.editInfo(t),this.hideInfoTopline(t),this.showTickIcon(t),this.showTrashIcon(t)),t.target.classList.contains("tick-icon")){var a=t.target.getAttribute("data-bookmark"),i=document.getElementById("edit-title-".concat(a)),s=document.getElementById("edit-description-".concat(a));this.options.app.getBookmark(a).then(function(e){e.getProperties().then(function(t){t.qMetaDef.title=i.value,t.qMetaDef.description=s.value,e.setProperties(t),n.render()})})}if(t.target.classList.contains("copy")&&(this.copyToClipboard(),this.toggleCopied()),t.target.classList.contains("public-li")||t.target.classList.contains("myBookmarks-li")){var c=t.target.getAttribute("data-bookmark");this.options.app.applyBookmark(c).then(function(t){console.log("apply result",t)})}}},{key:"handleChange",value:function(t){t.target.classList.contains("search")&&this.render(t.target.value)}},{key:"searchFunction",value:function(){var t;t=document.getElementById("myInput").value.toLowerCase(),this.render(t)}},{key:"openForm",value:function(){var t=document.getElementById("bookmarkPopup");t&&(t.style.display="block");var e=document.getElementById("bookmarkContainer");e&&(e.style.display="block")}},{key:"closeForm",value:function(){document.getElementById("bookmarkPopup").style.display="none";var t=document.getElementById("bookmarkContainer");t&&(t.style.display="none")}},{key:"createNewBookmark",value:function(){var t=document.getElementById("createForm"),e=document.getElementById("bookmarkPopup"),n=document.getElementById("bookmarkContainer");t.style.display="flex",e.style.backgroundColor="#bdbdbd",n.style.opacity=".4"}},{key:"copyToClipboard",value:function(t){var e=document.getElementById("infoInput");e.select(),navigator.clipboard.writeText(e.value)}},{key:"closeBookmark",value:function(){document.getElementById("createForm").style.display="none",document.getElementById("bookmarkContainer").style.opacity="1"}},{key:"closePublicUL",value:function(){document.getElementById("public-placeholder").classList.toggle("active")}},{key:"closeMyBookmarksUL",value:function(){document.getElementById("myBookmarks-placeholder").classList.toggle("active")}},{key:"toggleInfo",value:function(t){Array.from(document.getElementsByClassName("info-popup")).forEach(function(t){t.classList.remove("active")});var e=t.target.getAttribute("data-bookmark"),n=document.getElementById("info-popup-".concat(e));n.classList.add("active"),document.getElementById("info-popup-mask").classList.add("active")}},{key:"enableCreate",value:function(){document.getElementById("createSubmit").disabled=!1}},{key:"disableCreate",value:function(){document.getElementById("createSubmit").disabled=!0}},{key:"editInfo",value:function(t){var e=t.target.getAttribute("data-bookmark"),n=document.getElementById("edit-info-".concat(e)),o=document.getElementById("edit-inputs-".concat(e));n.classList.add("active"),o.classList.toggle("active"),this.hideInfoTopline(t)}},{key:"hideInfoTopline",value:function(t){var e=t.target.getAttribute("data-bookmark");document.getElementById("info-topline-".concat(e)).classList.toggle("active")}},{key:"showTickIcon",value:function(t){var e=t.target.getAttribute("data-bookmark");document.getElementById("tick-icon-".concat(e)).classList.toggle("active")}},{key:"showTrashIcon",value:function(t){var e=t.target.getAttribute("data-bookmark");document.getElementById("trashIcon-".concat(e)).classList.toggle("active")}},{key:"toggleCopied",value:function(){document.getElementById("copied").classList.toggle("active"),setTimeout(this.toggleCopied,3e3)}}]),o}(),session=enigma.create({schema:schema,url:"wss://ec2-3-86-99-193.compute-1.amazonaws.com/app//d077bbca-1fa2-4564-83d5-88f801899a5c"});session.open().then(function(t){console.log(t),t.openDoc("d077bbca-1fa2-4564-83d5-88f801899a5c").then(function(t){console.log(t);new Bookmark("websy-bookmark",{app:t})})});